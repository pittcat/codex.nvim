# codex.nvim

è½»é‡çº§ Neovim é›†æˆ OpenAI Codex CLIï¼šåœ¨ç»ˆç«¯åˆ†å±ä¸­æ‰“å¼€ Codex TUIï¼Œå¹¶æ”¯æŒâ€œä»»åŠ¡å®Œæˆæé†’â€ã€‚

- ä»£ç ä»“åº“ç»“æ„ä¸æµ‹è¯•è¯´æ˜è§ `README.md`ã€‚
- ç³»ç»Ÿé€šçŸ¥ï¼ˆå¸¦æç¤ºéŸ³ï¼‰ç›®å‰ä¼˜å…ˆä½¿ç”¨ macOS çš„ `terminal-notifier`ï¼Œè‹¥ä¸å¯ç”¨åˆ™å›é€€åˆ° `osascript`ï¼Œå†å›é€€åˆ° `vim.notify`ï¼ˆæ— ç³»ç»Ÿå£°éŸ³ï¼‰ã€‚

## å¿«é€Ÿå¼€å§‹

```lua
require('codex').setup()

-- æ¨èæ˜ å°„
vim.keymap.set('n', '<leader>co', function() require('codex').open() end, { desc = 'Codex: Open TUI' })
vim.keymap.set('n', '<leader>ct', function() require('codex').toggle() end, { desc = 'Codex: Toggle terminal' })
```

## æ—¥å¿—

```lua
require('codex').setup({
  log_level = 'info',          -- 'trace'|'debug'|'info'|'warn'|'error'
  log_to_file = false,         -- å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼ˆé»˜è®¤ falseï¼‰
})
```

## ç»ˆç«¯é€‰é¡¹

- `direction`: 'horizontal' | 'vertical'
- `size`: è¡Œ/åˆ—æ•°é‡ï¼›0<å¤§å°<1 è¡¨ç¤ºå½“å‰çª—å£çš„æ¯”ä¾‹
- `position`: 'left' | 'right' | 'top' | 'bottom'
- `provider`: 'native' | 'snacks' | 'auto'
- `reuse`: æ˜¯å¦å¤ç”¨å·²æœ‰ç»ˆç«¯ç¼“å†²åŒº
- `auto_insert_mode`: æ‰“å¼€åè¿›å…¥æ’å…¥æ¨¡å¼

## å®Œæˆæé†’ï¼ˆç³»ç»Ÿé€šçŸ¥ + å£°éŸ³ï¼‰

codex.nvim æä¾›ä¸¤ç§æé†’æ¨¡å¼ï¼Œå»ºè®®äºŒé€‰ä¸€ï¼š

- `alert_on_idle = true`: å½“ç»ˆç«¯è¾“å‡ºè¿›å…¥â€œç©ºé—²â€ï¼ˆä¸å†äº§ç”Ÿæ–°æ–‡æœ¬ï¼‰æ—¶æé†’ï¼›é€‚åˆ Codex TUI å¸¸é©»ï¼Œä»»åŠ¡è·‘å®Œä¹Ÿä¸é€€å‡ºçš„æƒ…å†µã€‚
- `alert_on_exit = true`: å½“ä»»åŠ¡è¿›ç¨‹é€€å‡ºæ—¶æé†’ã€‚

ç¤ºä¾‹ï¼š

```lua
require('codex').setup({
  -- äºŒé€‰ä¸€
  alert_on_idle = true,
  -- alert_on_exit = true,

  notification = {
    enabled = true,              -- å¼€å¯ç³»ç»Ÿé€šçŸ¥
    sound = 'Glass',             -- macOS ç³»ç»Ÿé€šçŸ¥å£°éŸ³å
    include_project_path = true, -- åœ¨æ¶ˆæ¯ä¸­åŒ…å«é¡¹ç›®è·¯å¾„
    speak = false,               -- å…³é—­è¯­éŸ³æ’­æŠ¥ï¼ˆé»˜è®¤ falseï¼‰
    backend = 'terminal-notifier', -- ä¼˜å…ˆä½¿ç”¨ terminal-notifier
    terminal_notifier = {
      ignore_dnd = true,           -- ä¼ é€’ -ignoreDnD
      sender = 'com.apple.Terminal',
      group = 'codex.nvim',
      activate = 'com.apple.Terminal',
    },

    -- ä»…åœ¨ alert_on_idle=true æ—¶ç”Ÿæ•ˆ
    idle = {
      check_interval = 1500,     -- é‡‡æ ·é—´éš”ï¼ˆæ¯«ç§’ï¼‰
      idle_checks = 3,           -- è¿ç»­æ— å˜åŒ–çš„é‡‡æ ·æ¬¡æ•°
      lines_to_check = 40,       -- ç”¨äºå“ˆå¸Œæ¯”å¯¹çš„å°¾éƒ¨è¡Œæ•°
      require_activity = true,   -- å…ˆè§‚å¯Ÿåˆ°æœ‰è¾“å‡ºå†å…è®¸åˆ¤å®šç©ºé—²
      min_change_ticks = 3,      -- è‡³å°‘è§‚å¯Ÿåˆ° N æ¬¡å˜åŒ–å†å…è®¸åˆ¤å®š
    },
  },
})
```

### è¡Œä¸ºè¯´æ˜

- macOSï¼šä¼˜å…ˆä½¿ç”¨ `terminal-notifier` å‘é€ç³»ç»Ÿæ¨ªå¹…ä¸å£°éŸ³ï¼›è‹¥ä¸å¯ç”¨åˆ™å›é€€åˆ° `osascript`ï¼›å†ä¸è¡Œå›é€€åˆ° `vim.notify`ï¼ˆæ— ç³»ç»Ÿå£°éŸ³ï¼‰ã€‚
- å…¶ä»–å¹³å°ï¼šå›é€€ä¸º `vim.notify`ï¼ˆæ²¡æœ‰ç³»ç»Ÿå£°éŸ³ï¼‰ã€‚
- ç©ºé—²æé†’ï¼ˆalert_on_idleï¼‰ï¼šä¸€æ¬¡æ€§æé†’ï¼Œæé†’ååœæ­¢ç›‘æ§ï¼›ä¸‹æ¬¡å†æ¬¡è¿è¡Œ Codex ä¼šè‡ªåŠ¨é‡æ–°å¼€å¯ç›‘æ§ã€‚
- é€€å‡ºæé†’ï¼ˆalert_on_exitï¼‰ï¼šçŸ­æ—¶é—´å†…çš„é‡å¤æˆåŠŸæé†’ä¼šè‡ªåŠ¨å»é‡ï¼ˆä¾‹å¦‚ idle ä¸ exit åŒæ—¶è§¦å‘æ—¶åªå‘ä¸€æ¬¡ï¼‰ã€‚
- ç©ºé—²æé†’æŠ‘åˆ¶ï¼šè‹¥ç»ˆç«¯å°¾éƒ¨æ–‡æœ¬åŒ…å«å–æ¶ˆæ ‡è®°ï¼ˆå¦‚â€œRequest interrupted by userâ€ã€â€œCanceledâ€ã€â€œå–æ¶ˆâ€ï¼‰ï¼Œåˆ™ä¸å‘é€å®Œæˆæé†’ã€‚å¯é€šè¿‡ `notification.idle.cancel_markers` é…ç½®ã€‚
  - é»˜è®¤å·²åŒ…å«ï¼šâ€œğŸ–â€Š Tell the model what to do differentlyâ€ ä»¥åŠä¸å¸¦è¡¨æƒ…çš„çº¯æ–‡æœ¬ç‰ˆæœ¬ã€‚

### å‚æ•°è§£é‡Šï¼ˆidleï¼‰

- `check_interval`ï¼ˆæ¯«ç§’ï¼‰ï¼šå¤šé•¿æ—¶é—´å–ä¸€æ¬¡ç»ˆç«¯å°¾éƒ¨æ–‡æœ¬åšå“ˆå¸Œã€‚
- `idle_checks`ï¼šè¿ç»­å¤šå°‘æ¬¡å“ˆå¸Œä¸€è‡´åˆ¤å®šä¸ºç©ºé—²ã€‚
- `lines_to_check`ï¼šå–ç»ˆç«¯å°¾éƒ¨å¤šå°‘è¡Œä½œä¸ºæ¯”è¾ƒå†…å®¹ã€‚
- `require_activity`ï¼šæ˜¯å¦å¿…é¡»å…ˆçœ‹åˆ°è¾“å‡ºå˜åŒ–å†å…è®¸ç©ºé—²åˆ¤å®šã€‚
- `min_change_ticks`ï¼šè‡³å°‘è§‚å¯Ÿåˆ° N æ¬¡å˜åŒ–åï¼Œæ‰å…è®¸å°†åç»­é™é»˜è§†ä¸ºå®Œæˆã€‚

## ç»ˆç«¯æ¡¥æ¥åŠŸèƒ½

ç›´æ¥å‘æ‰“å¼€çš„ Codex ç»ˆç«¯å‘é€æ–‡ä»¶è·¯å¾„å’Œä»£ç é€‰æ‹©ï¼š

- `:CodexSendPath` â€” å‘é€å½“å‰ç¼“å†²åŒºè·¯å¾„åˆ°é™„åŠ çš„ç»ˆç«¯ï¼ˆä½¿ç”¨ç©ºæ ¼åˆ†éš”ç¬¦ä¾¿äºè¿ç»­å‘é€ï¼‰
- `:CodexSendSelection` â€” æ ¹æ®é…ç½®å‘é€å¯è§†é€‰æ‹©ä½œä¸ºå¼•ç”¨æˆ–å†…å®¹
- `:CodexSendReference` â€” å‘é€å¯è§†é€‰æ‹©ä½œä¸ºæ–‡ä»¶å¼•ç”¨ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†éš”ç¬¦ï¼ˆå¦‚ `@file.lua#L10-L20`ï¼‰
- `:CodexSendContent` â€” å‘é€å¯è§†é€‰æ‹©åŠå®é™…ä»£ç å†…å®¹

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```vim
" å‘é€å½“å‰æ–‡ä»¶è·¯å¾„
:CodexSendPath

" å¯è§†æ¨¡å¼ï¼šé€‰æ‹©ä»£ç ç„¶åå‘é€å¼•ç”¨
:'<,'>CodexSendSelection

" å‘é€ç‰¹å®šè¡ŒèŒƒå›´ä½œä¸ºå¼•ç”¨
:187,188CodexSendReference
```

### ç»ˆç«¯æ¡¥æ¥é…ç½®

```lua
require('codex').setup({
  terminal_bridge = {
    path_format = 'rel',          -- 'abs' | 'rel' | 'basename' - æ–‡ä»¶è·¯å¾„æ ¼å¼
    path_prefix = '@',            -- è·¯å¾„å‰ç¼€ï¼ˆå¦‚ Claude Code çš„ '@'ï¼‰
    auto_attach = true,           -- è‡ªåŠ¨é™„åŠ ç”± CodexOpen åˆ›å»ºçš„ç»ˆç«¯
    selection_mode = 'reference', -- 'reference' | 'content' - å¯è§†é€‰æ‹©çš„é»˜è®¤è¡Œä¸º
  },
})
```

**é…ç½®é€‰é¡¹ï¼š**
- `path_format`ï¼šæ–‡ä»¶è·¯å¾„æ ¼å¼åŒ–æ–¹å¼ï¼š
  - `'abs'`ï¼šç»å¯¹è·¯å¾„ï¼ˆå¦‚ `@/Users/name/project/file.lua`ï¼‰
  - `'rel'`ï¼šç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•ï¼ˆå¦‚ `@file.lua` æˆ– `@src/module.lua`ï¼‰
  - `'basename'`ï¼šä»…æ–‡ä»¶åï¼ˆå¦‚ `@file.lua`ï¼‰
- `path_prefix`ï¼šè·¯å¾„å‰ç¼€å­—ç¬¦ä¸²ï¼ˆé€šå¸¸ä¸º `'@'` ä»¥å…¼å®¹ Claude Codeï¼‰
- `auto_attach`ï¼šä¸º `true` æ—¶ï¼Œ`:CodexOpen` æ‰“å¼€çš„ç»ˆç«¯è‡ªåŠ¨é™„åŠ åˆ°å½“å‰æ ‡ç­¾é¡µ
- `selection_mode`ï¼š`:CodexSendSelection` çš„é»˜è®¤è¡Œä¸ºï¼š
  - `'reference'`ï¼šå‘é€æ–‡ä»¶å¼•ç”¨å¦‚ `@file.lua#L10-L20`
  - `'content'`ï¼šå‘é€å¼•ç”¨ + å®é™…ä»£ç å†…å®¹

**æ ‡ç­¾éš”ç¦»**ï¼šæ¯ä¸ªæ ‡ç­¾é¡µç»´æŠ¤è‡ªå·±çš„ç»ˆç«¯è¿æ¥ï¼Œé¿å…å¤šæ ‡ç­¾å·¥ä½œæ—¶çš„æ··æ·†ã€‚

**å·¥ä½œæµç¨‹ï¼š**
1. æ‰“å¼€ Codex ç»ˆç«¯ï¼š`:CodexOpen`ï¼ˆè‡ªåŠ¨é™„åŠ åˆ°å½“å‰æ ‡ç­¾é¡µï¼‰
2. å‘é€æ–‡ä»¶è·¯å¾„ï¼š`:CodexSendPath`ï¼ˆè·¯å¾„åæ·»åŠ ç©ºæ ¼ä»¥ä¾¿è¿ç»­è¾“å…¥ï¼‰
3. é€‰æ‹©ä»£ç å¹¶å‘é€å¼•ç”¨ï¼š`:'<,'>CodexSendSelection`

**æ³¨æ„ï¼š**è·¯å¾„å’Œå¼•ç”¨å‘½ä»¤ä¼šè¿½åŠ ç©ºæ ¼è€Œä¸æ˜¯æ¢è¡Œï¼Œå…è®¸åœ¨åŒä¸€è¡Œå‘é€å¤šä¸ªè·¯å¾„/å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œä¸¤æ¬¡ `:CodexSendPath` ä¼šå¾—åˆ° `@file1.lua @file2.lua` åœ¨åŒä¸€è¡Œã€‚

## å¹³å°è¯´æ˜

- macOSï¼šå®Œæ•´æ”¯æŒç³»ç»Ÿé€šçŸ¥ä¸å£°éŸ³ï¼›å¯é€‰è¯­éŸ³æ’­æŠ¥ï¼ˆé»˜è®¤å…³é—­ï¼‰ã€‚
- å…¶ä»–ç³»ç»Ÿï¼šå›é€€åˆ° `vim.notify`ã€‚å¦‚éœ€ç³»ç»Ÿçº§å£°éŸ³ä¸æ¨ªå¹…ï¼Œå¯è‡ªè¡Œæ‰©å±•é€šçŸ¥å®ç°ï¼ˆæ¬¢è¿ PRï¼‰ã€‚

## æµ‹è¯•

- è¿è¡Œï¼š`make test`ï¼ˆæ— éœ€å®‰è£…çœŸå® Codex CLIï¼Œæµ‹è¯•ä½¿ç”¨ `echo` ä»£æ›¿ï¼‰ã€‚

## æ•…éšœæ’æŸ¥

- çœ‹ä¸åˆ°ç³»ç»Ÿé€šçŸ¥æˆ–å£°éŸ³ï¼š
  - æ£€æŸ¥ `osascript` æ˜¯å¦å¯ç”¨ï¼ˆ`which osascript`ï¼‰ã€‚
  - `notification.enabled` æ˜¯å¦ä¸º `true`ï¼Œ`sound` æ˜¯å¦æœ‰æ•ˆã€‚
- æé†’è¿‡æ—©ï¼šé€‚å½“å¢å¤§ `idle_checks` æˆ– `min_change_ticks`ï¼Œæˆ–å¢å¤§ `check_interval`ã€‚
- æƒ³æ›´å¿«æé†’ï¼šé™ä½ `check_interval` æˆ– `idle_checks`ï¼ˆæ³¨æ„è¯¯æŠ¥é£é™©ï¼‰ã€‚
